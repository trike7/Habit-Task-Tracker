<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Habit & Task Tracker Plus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --bg-soft: #1e293b;
      --bg-softer: #020617;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --danger: #f97373;
      --danger-soft: rgba(239, 68, 68, 0.1);
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --border: #334155;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 22px 45px rgba(15, 23, 42, 0.65);
      --shadow-chip: 0 10px 28px rgba(15, 23, 42, 0.7);
      --shadow-button: 0 16px 32px rgba(34, 197, 94, 0.4);
      --blur: 20px;
    }

    [data-theme="light"] {
      --bg: #e5e7eb;
      --bg-soft: #f3f4f6;
      --bg-softer: #f9fafb;
      --accent: #16a34a;
      --accent-soft: rgba(22, 163, 74, 0.12);
      --danger: #b91c1c;
      --danger-soft: rgba(185, 28, 28, 0.1);
      --text: #020617;
      --text-soft: #4b5563;
      --border: #d1d5db;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.25);
      --shadow-chip: 0 8px 18px rgba(15, 23, 42, 0.12);
      --shadow-button: 0 12px 24px rgba(22, 163, 74, 0.35);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%, #000 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      color: var(--text);
      padding: 32px 16px;
      transition: background 0.25s ease-out, color 0.25s ease-out;
    }

    [data-theme="light"] body {
      background: radial-gradient(circle at top, #e5e7eb 0, #f3f4f6 55%, #e5e7eb 100%);
    }

    .app-wrapper {
      width: 100%;
      max-width: 1080px;
      backdrop-filter: blur(var(--blur));
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.98));
      border-radius: 32px;
      border: 1px solid rgba(148, 163, 184, 0.22);
      box-shadow: 0 40px 80px rgba(15, 23, 42, 0.9);
      padding: 24px;
      position: relative;
      overflow: hidden;
      color: var(--text);
      transition: background 0.25s ease-out, border-color 0.25s ease-out, box-shadow 0.25s ease-out;
    }

    [data-theme="light"] .app-wrapper {
      background: linear-gradient(135deg, rgba(249, 250, 251, 0.97), rgba(243, 244, 246, 0.98));
      border-color: rgba(148, 163, 184, 0.45);
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.25);
    }

    .app-wrapper::before,
    .app-wrapper::after {
      content: "";
      position: absolute;
      border-radius: 999px;
      filter: blur(40px);
      opacity: 0.3;
      z-index: -1;
    }

    .app-wrapper::before {
      width: 260px;
      height: 260px;
      background: radial-gradient(circle, rgba(34, 197, 94, 0.45), transparent 70%);
      top: -60px;
      right: -80px;
    }

    .app-wrapper::after {
      width: 220px;
      height: 220px;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.45), transparent 70%);
      bottom: -80px;
      left: -60px;
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 20px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .pill {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.26);
      background: rgba(15, 23, 42, 0.8);
      padding: 4px 10px;
      font-size: 11px;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    [data-theme="light"] .pill {
      background: rgba(243, 244, 246, 0.9);
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: radial-gradient(circle, var(--accent) 0, #22c55e 40%, #16a34a 100%);
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.8);
    }

    h1 {
      font-size: 20px;
      letter-spacing: 0.02em;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    h1 span.badge {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--accent);
      border-radius: 999px;
      padding: 2px 8px;
      background: rgba(34, 197, 94, 0.08);
      border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .subtitle {
      font-size: 12px;
      color: var(--text-soft);
    }

    .date-block {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .big-date {
      font-size: 18px;
      font-weight: 600;
      color: #f9fafb;
      letter-spacing: 0.04em;
    }

    [data-theme="light"] .big-date {
      color: #020617;
    }

    .top-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 4px;
      font-size: 11px;
    }

    .theme-toggle {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-soft);
      padding: 3px 8px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
    }

    [data-theme="light"] .theme-toggle {
      background: rgba(243, 244, 246, 0.95);
    }

    .theme-toggle span.icon {
      font-size: 14px;
    }

    .export-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-soft);
      padding: 3px 8px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
    }

    [data-theme="light"] .export-btn {
      background: rgba(243, 244, 246, 0.95);
    }

    .tabs {
      display: inline-flex;
      background: rgba(15, 23, 42, 0.9);
      padding: 3px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.8);
      margin-bottom: 18px;
      font-size: 11px;
    }

    [data-theme="light"] .tabs {
      background: rgba(243, 244, 246, 0.95);
      box-shadow: 0 12px 26px rgba(15, 23, 42, 0.22);
      border-color: rgba(148, 163, 184, 0.5);
    }

    .tab {
      border: none;
      outline: none;
      padding: 6px 14px;
      border-radius: 999px;
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.18s ease-out;
    }

    .tab span.icon {
      font-size: 13px;
    }

    .tab.active {
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.35), rgba(15, 23, 42, 0.95));
      color: #e5e7eb;
      box-shadow: 0 14px 30px rgba(22, 163, 74, 0.55);
    }

    [data-theme="light"] .tab.active {
      color: #022c22;
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.25), #bbf7d0);
    }

    .tab-count {
      font-size: 10px;
      color: var(--text-soft);
      background: rgba(15, 23, 42, 0.9);
      padding: 1px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    [data-theme="light"] .tab-count {
      background: rgba(248, 250, 252, 0.96);
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .search-row {
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1;
    }

    .search-input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      background: rgba(15, 23, 42, 0.92);
      padding: 5px 10px;
      font-size: 11px;
      color: var(--text);
      outline: none;
    }

    [data-theme="light"] .search-input {
      background: rgba(243, 244, 246, 0.95);
      border-color: rgba(148, 163, 184, 0.7);
    }

    .search-input::placeholder {
      color: rgba(148, 163, 184, 0.85);
    }

    .filter-chips {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
      font-size: 11px;
    }

    .filter-chip {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-soft);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .filter-chip.active {
      background: var(--accent-soft);
      color: var(--accent);
      border-color: rgba(34, 197, 94, 0.7);
    }

    [data-theme="light"] .filter-chip {
      background: rgba(243, 244, 246, 0.9);
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.1fr);
      gap: 18px;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.12), rgba(15, 23, 42, 0.96));
      border-radius: 22px;
      border: 1px solid rgba(148, 163, 184, 0.26);
      box-shadow: var(--shadow-soft);
      padding: 16px 16px 14px;
      position: relative;
      overflow: hidden;
      transition: background 0.25s ease-out, border-color 0.25s ease-out, box-shadow 0.25s ease-out;
    }

    [data-theme="light"] .card {
      background: radial-gradient(circle at top left, rgba(209, 213, 219, 0.18), #f9fafb);
      border-color: rgba(148, 163, 184, 0.55);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.22);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
    }

    .card-title {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title span.icon {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 1));
    }

    [data-theme="light"] .card-title span.icon {
      background: rgba(248, 250, 252, 0.98);
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    .card-meta {
      font-size: 11px;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .dot {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.6);
    }

    .stats-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
      font-size: 11px;
      flex-wrap: wrap;
    }

    .stat-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: var(--shadow-chip);
    }

    [data-theme="light"] .stat-chip {
      background: rgba(248, 250, 252, 0.98);
      border-color: rgba(148, 163, 184, 0.5);
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.12);
    }

    .stat-chip .label {
      color: var(--text-soft);
    }

    .stat-chip .value {
      font-weight: 600;
      color: var(--text);
    }

    .medals {
      display: flex;
      align-items: center;
      gap: 4px;
      flex-wrap: wrap;
      font-size: 11px;
    }

    .medal {
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.4);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    [data-theme="light"] .medal {
      background: rgba(248, 250, 252, 0.98);
      border-color: rgba(148, 163, 184, 0.6);
    }

    .medal span.icon {
      font-size: 12px;
    }

    .progress-bar {
      width: 100%;
      height: 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(30, 64, 175, 0.6);
      overflow: hidden;
      margin-bottom: 10px;
      position: relative;
    }

    [data-theme="light"] .progress-bar {
      background: rgba(243, 244, 246, 0.98);
      border-color: rgba(59, 130, 246, 0.55);
    }

    .progress-inner {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #a855f7, #0ea5e9);
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.9);
      transform-origin: left center;
      transform: scaleX(0);
      transition: transform 0.25s ease-out;
    }

    .progress-bar::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(248, 250, 252, 0.3), transparent 60%);
      opacity: 0.32;
      pointer-events: none;
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
      margin-bottom: 8px;
    }

    .list::-webkit-scrollbar,
    .small-list::-webkit-scrollbar {
      width: 6px;
    }

    .list::-webkit-scrollbar-thumb,
    .small-list::-webkit-scrollbar-thumb {
      background: rgba(30, 64, 175, 0.9);
      border-radius: 999px;
    }

    .item {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 10px;
      padding: 7px 9px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(30, 64, 175, 0.7);
      box-shadow: 0 16px 30px rgba(15, 23, 42, 0.85);
      font-size: 12px;
    }

    [data-theme="light"] .item {
      background: rgba(248, 250, 252, 0.98);
      border-color: rgba(148, 163, 184, 0.75);
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.16);
    }

    .item-main {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      flex: 1;
    }

    .check-circle {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 1));
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
      color: var(--accent);
      transition: all 0.16s ease-out;
    }

    [data-theme="light"] .check-circle {
      background: rgba(248, 250, 252, 0.98);
    }

    .check-circle.checked {
      border-color: rgba(34, 197, 94, 0.7);
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.1), rgba(15, 23, 42, 1));
      box-shadow: 0 0 16px rgba(34, 197, 94, 0.8);
    }

    [data-theme="light"] .check-circle.checked {
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.18), rgba(248, 250, 252, 0.98));
    }

    .item-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .item-title-row {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .item-title {
      font-weight: 500;
    }

    .item-title-input {
      border-radius: 6px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 2px 4px;
      font-size: 11px;
      background: transparent;
      color: var(--text);
      min-width: 120px;
    }

    .tag-pill {
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 10px;
      color: var(--text-soft);
    }

    .item-meta {
      font-size: 10px;
      color: var(--text-soft);
    }

    .item-notes {
      font-size: 10px;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .item-notes-input {
      width: 100%;
      resize: vertical;
      min-height: 30px;
      max-height: 80px;
      border-radius: 6px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 3px 5px;
      font-size: 10px;
      background: transparent;
      color: var(--text);
    }

    .item-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 11px;
    }

    .chip {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-soft);
    }

    [data-theme="light"] .chip {
      background: rgba(248, 250, 252, 0.98);
      border-color: rgba(148, 163, 184, 0.6);
    }

    .btn-icon {
      border: none;
      outline: none;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 999px;
      padding: 2px 5px;
      cursor: pointer;
      color: var(--text-soft);
      border: 1px solid rgba(51, 65, 85, 0.9);
      transition: all 0.16s ease-out;
      font-size: 11px;
    }

    [data-theme="light"] .btn-icon {
      background: rgba(248, 250, 252, 0.98);
      border-color: rgba(148, 163, 184, 0.8);
    }

    .btn-icon:hover {
      background: rgba(31, 41, 55, 0.9);
      color: #e5e7eb;
    }

    [data-theme="light"] .btn-icon:hover {
      background: rgba(229, 231, 235, 0.98);
      color: #020617;
    }

    .btn-icon.danger {
      border-color: rgba(239, 68, 68, 0.7);
      color: #fecaca;
      background: rgba(127, 29, 29, 0.75);
    }

    [data-theme="light"] .btn-icon.danger {
      background: rgba(254, 242, 242, 0.98);
      color: #991b1b;
      border-color: rgba(220, 38, 38, 0.8);
    }

    .btn-icon.danger:hover {
      background: rgba(185, 28, 28, 0.9);
      box-shadow: 0 0 14px rgba(248, 113, 113, 0.7);
    }

    [data-theme="light"] .btn-icon.danger:hover {
      background: rgba(248, 113, 113, 0.16);
    }

    .btn-icon.edit {
      font-size: 12px;
    }

    .add-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 2px;
      flex-wrap: wrap;
    }

    .input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(51, 65, 85, 0.96);
      background: rgba(15, 23, 42, 0.96);
      padding: 6px 10px;
      font-size: 11px;
      color: #e5e7eb;
      outline: none;
      box-shadow: 0 14px 24px rgba(15, 23, 42, 0.9);
    }

    [data-theme="light"] .input {
      background: rgba(248, 250, 252, 0.98);
      border-color: rgba(148, 163, 184, 0.9);
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.15);
      color: #020617;
    }

    .input::placeholder {
      color: rgba(148, 163, 184, 0.8);
    }

    .select {
      border-radius: 999px;
      border: 1px solid rgba(51, 65, 85, 0.96);
      background: rgba(15, 23, 42, 0.96);
      padding: 6px 8px;
      font-size: 11px;
      color: #e5e7eb;
      outline: none;
    }

    [data-theme="light"] .select {
      background: rgba(248, 250, 252, 0.98);
      border-color: rgba(148, 163, 184, 0.9);
      color: #020617;
    }

    .btn-primary {
      border-radius: 999px;
      border: none;
      outline: none;
      padding: 6px 12px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #22c55e, #4ade80);
      color: #022c22;
      box-shadow: var(--shadow-button);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary span.icon {
      font-size: 13px;
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 10px 20px rgba(22, 163, 74, 0.65);
    }

    .section-label {
      font-size: 11px;
      color: var(--text-soft);
      margin: 4px 0 6px;
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .pill-mini {
      padding: 1px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.3);
      font-size: 10px;
      color: var(--text-soft);
    }

    [data-theme="light"] .pill-mini {
      background: rgba(248, 250, 252, 0.98);
      border-color: rgba(148, 163, 184, 0.6);
    }

    .tasks-columns {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 8px;
      font-size: 11px;
    }

    .tasks-column-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
      color: var(--text-soft);
    }

    .small-list {
      max-height: 190px;
      overflow-y: auto;
      padding-right: 4px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .small-list .item {
      padding: 6px 8px;
    }

    .small-list .item-title {
      font-size: 11px;
    }

    .small-list .check-circle {
      width: 16px;
      height: 16px;
      font-size: 11px;
    }

    .empty-state {
      font-size: 11px;
      color: var(--text-soft);
      opacity: 0.8;
      padding: 4px 4px 6px;
    }

    .mini-chart {
      display: flex;
      align-items: flex-end;
      gap: 4px;
      height: 32px;
    }

    .mini-bar {
      flex: 1;
      border-radius: 4px 4px 0 0;
      background: rgba(34, 197, 94, 0.35);
    }

    .mini-bar-labels {
      display: flex;
      justify-content: space-between;
      font-size: 9px;
      color: var(--text-soft);
      margin-top: 2px;
    }

    @media (max-width: 800px) {
      .app-wrapper {
        padding: 18px 14px;
        border-radius: 22px;
      }

      .app-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .date-block {
        align-items: flex-start;
      }

      .grid {
        grid-template-columns: minmax(0,1fr);
      }

      .tabs {
        width: 100%;
        justify-content: space-between;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 16px 8px;
      }

      .app-wrapper {
        padding: 14px 10px;
      }

      .check-circle {
        width: 22px;
        height: 22px;
      }

      .btn-primary,
      .btn-icon,
      .select {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="app-wrapper" aria-label="Habit and Task Tracker">
    <header class="app-header">
      <div class="title-block">
        <div class="pill">
          <span class="pill-dot"></span>
          Sistema ligero de seguimiento diario
        </div>
        <div class="title-row">
          <h1>
            Habit & Task Tracker
            <span class="badge">offline ‚Ä¢ local</span>
          </h1>
        </div>
        <div class="subtitle">
          Marca tus h√°bitos y tareas del d√≠a. Todo se guarda en este navegador, con exportaci√≥n/importaci√≥n opcional.
        </div>
      </div>
      <div>
        <div class="date-block">
          <div class="big-date" id="todayLabel"></div>
          <div id="streakLabel">Racha: 0 d√≠as seguidos</div>
          <div class="top-controls">
            <button id="themeToggle" class="theme-toggle" aria-label="Cambiar tema">
              <span class="icon" id="themeIcon">üåô</span>
              <span id="themeText">Oscuro</span>
            </button>
            <button id="exportBtn" class="export-btn">
              üì§ Exportar
            </button>
            <label class="export-btn" style="cursor:pointer;">
              üì• Importar
              <input id="importInput" type="file" accept="application/json" style="display:none;" />
            </label>
          </div>
        </div>
      </div>
    </header>

    <div class="top-row">
      <div class="tabs" role="tablist">
        <button class="tab active" data-view="both" role="tab">
          <span class="icon">üìä</span>
          Hoy
          <span class="tab-count" id="tabTotalCount">0/0</span>
        </button>
        <button class="tab" data-view="habits" role="tab">
          <span class="icon">üß±</span>
          H√°bitos
          <span class="tab-count" id="tabHabitsCount">0</span>
        </button>
        <button class="tab" data-view="tasks" role="tab">
          <span class="icon">‚úÖ</span>
          Tareas
          <span class="tab-count" id="tabTasksCount">0</span>
        </button>
      </div>
      <div class="search-row">
        <input
          id="searchInput"
          class="search-input"
          type="text"
          placeholder="Buscar por texto o etiqueta‚Ä¶"
          aria-label="Buscar h√°bitos y tareas"
        />
      </div>
      <div class="filter-chips" aria-label="Filtros">
        <button class="filter-chip active" data-filter="all">Todos</button>
        <button class="filter-chip" data-filter="pending">Pendientes</button>
        <button class="filter-chip" data-filter="done">Hechos</button>
      </div>
    </div>

    <main class="grid">
      <section class="card" id="habitsCard">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="icon">üß±</span>
              H√°bitos de hoy
            </div>
            <div class="card-subtitle">
              Define frecuencia, etiquetas y notas. Marca una vez por d√≠a.
            </div>
          </div>
          <div class="card-meta">
            <span class="dot"></span>
            <span id="habitsMetaLabel">0/0 completados</span>
          </div>
        </div>

        <div class="stats-row">
          <div class="stat-chip">
            <span class="label">Progreso total</span>
            <span class="value" id="habitsProgressPct">0%</span>
          </div>
          <div class="stat-chip">
            <span class="label">H√°bitos activos</span>
            <span class="value" id="habitsActiveCount">0</span>
          </div>
          <div class="medals" id="habitsMedals"></div>
        </div>

        <div class="progress-bar">
          <div class="progress-inner" id="habitsProgressBar"></div>
        </div>

        <div class="list" id="habitsList"></div>

        <div class="section-label">
          Nuevo h√°bito
          <span class="pill-mini">Ej: ‚ÄúLeer 10 min‚Äù, ‚ÄúBeber agua‚Äù</span>
        </div>
        <div class="add-row">
          <input
            id="habitInput"
            class="input"
            type="text"
            placeholder="T√≠tulo del h√°bito"
          />
          <input
            id="habitTagInput"
            class="input"
            type="text"
            placeholder="Etiqueta opcional (ej. salud, foco)"
            style="max-width:150px;"
          />
          <select id="habitFrequency" class="select" aria-label="Frecuencia del h√°bito">
            <option value="daily">Diario</option>
            <option value="weekly">Semanal</option>
            <option value="monthly">Mensual</option>
            <option value="custom">Personalizado</option>
          </select>
          <button id="addHabitBtn" class="btn-primary">
            <span class="icon">Ôºã</span>
            A√±adir
          </button>
        </div>
        <textarea
          id="habitNotesInput"
          class="item-notes-input"
          placeholder="Notas generales para el h√°bito (opcional)‚Ä¶"
          style="margin-top:6px;"
        ></textarea>

        <div class="section-label" style="margin-top:8px;">
          Progreso semanal (h√°bitos completados por d√≠a)
        </div>
        <div>
          <div class="mini-chart" id="habitsMiniChart"></div>
          <div class="mini-bar-labels">
            <span>L</span><span>M</span><span>X</span><span>J</span><span>V</span><span>S</span><span>D</span>
          </div>
        </div>
      </section>

      <section class="card" id="tasksCard">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="icon">‚úÖ</span>
              Tareas de hoy
            </div>
            <div class="card-subtitle">
              Tareas puntuales con etiquetas, notas y edici√≥n r√°pida.
            </div>
          </div>
          <div class="card-meta">
            <span class="dot"></span>
            <span id="tasksMetaLabel">0 pendientes ¬∑ 0 hechas</span>
          </div>
        </div>

        <div class="stats-row">
          <div class="stat-chip">
            <span class="label">Tareas hoy</span>
            <span class="value" id="tasksTodayCount">0</span>
          </div>
          <div class="stat-chip">
            <span class="label">Completadas</span>
            <span class="value" id="tasksDoneCount">0</span>
          </div>
          <div class="medals" id="tasksMedals"></div>
        </div>

        <div class="tasks-columns">
          <div>
            <div class="tasks-column-title">
              <span>Pendientes</span>
              <span class="pill-mini" id="tasksPendingLabel">0</span>
            </div>
            <div class="small-list" id="tasksPendingList"></div>
          </div>
          <div>
            <div class="tasks-column-title">
              <span>Completadas</span>
              <span class="pill-mini" id="tasksCompletedLabel">0</span>
            </div>
            <div class="small-list" id="tasksCompletedList"></div>
          </div>
        </div>

        <div class="section-label">
          Nueva tarea
          <span class="pill-mini">Ej: ‚ÄúEnviar email‚Äù, ‚ÄúLlamar al banco‚Äù</span>
        </div>
        <div class="add-row">
          <input
            id="taskInput"
            class="input"
            type="text"
            placeholder="T√≠tulo de la tarea"
          />
          <input
            id="taskTagInput"
            class="input"
            type="text"
            placeholder="Etiqueta opcional (ej. trabajo, casa)"
            style="max-width:150px;"
          />
          <button id="addTaskBtn" class="btn-primary">
            <span class="icon">Ôºã</span>
            A√±adir
          </button>
        </div>
        <textarea
          id="taskNotesInput"
          class="item-notes-input"
          placeholder="Notas generales para la tarea (opcional)‚Ä¶"
          style="margin-top:6px;"
        ></textarea>
      </section>
    </main>
  </div>

  <script>
    const STORAGE_KEY = "habit_task_tracker_plus_v1";
    const THEME_KEY = "habit_task_tracker_theme";

    const state = {
      dateKey: null,
      habits: [],
      tasks: [],
      streak: 0,
      lastDate: null,
      filterText: "",
      filterStatus: "all",
      theme: "dark"
    };

    function todayKey() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return y + "-" + m + "-" + day;
    }

    function loadState() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        try {
          const parsed = JSON.parse(raw);
          if (parsed && typeof parsed === "object") {
            state.habits = parsed.habits || [];
            state.tasks = parsed.tasks || [];
            state.streak = parsed.streak || 0;
            state.lastDate = parsed.lastDate || null;
          }
        } catch (e) {
          console.warn("Error al cargar datos", e);
        }
      }

      const storedTheme = localStorage.getItem(THEME_KEY);
      if (storedTheme === "light" || storedTheme === "dark") {
        state.theme = storedTheme;
      }
    }

    function saveState() {
      const payload = {
        habits: state.habits,
        tasks: state.tasks,
        streak: state.streak,
        lastDate: state.dateKey
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    }

    function applyTheme() {
      const root = document.documentElement;
      const themeToggle = document.getElementById("themeToggle");
      const themeIcon = document.getElementById("themeIcon");
      const themeText = document.getElementById("themeText");

      if (state.theme === "light") {
        root.setAttribute("data-theme", "light");
        themeIcon.textContent = "üåû";
        themeText.textContent = "Claro";
      } else {
        root.setAttribute("data-theme", "dark");
        themeIcon.textContent = "üåô";
        themeText.textContent = "Oscuro";
      }
      localStorage.setItem(THEME_KEY, state.theme);
    }

    function toggleTheme() {
      state.theme = state.theme === "dark" ? "light" : "dark";
      applyTheme();
    }

    function formatTodayLabel() {
      const d = new Date();
      const days = ["Dom", "Lun", "Mar", "Mi√©", "Jue", "Vie", "S√°b"];
      const months = [
        "Ene","Feb","Mar","Abr","May","Jun",
        "Jul","Ago","Sep","Oct","Nov","Dic"
      ];
      return (
        days[d.getDay()] +
        " " +
        String(d.getDate()).padStart(2, "0") +
        " " +
        months[d.getMonth()] +
        " " +
        d.getFullYear()
      );
    }

    function updateStreak() {
      if (!state.lastDate) {
        state.streak = 0;
        return;
      }
      const last = new Date(state.lastDate);
      const today = new Date(state.dateKey);
      const diffMs = today - last;
      const diffDays = Math.round(diffMs / (1000 * 60 * 60 * 24));
      if (diffDays === 1) {
        state.streak = (state.streak || 0) + 1;
      } else if (diffDays > 1) {
        state.streak = 0;
      }
    }

    function renderHeader() {
      const todayLabel = document.getElementById("todayLabel");
      const streakLabel = document.getElementById("streakLabel");
      todayLabel.textContent = formatTodayLabel();
      streakLabel.textContent =
        "Racha: " + (state.streak || 0) + " d√≠as seguidos";
    }

    function addHabit(title, tag, frequency, notes) {
      const trimmed = (title || "").trim();
      if (!trimmed) return;
      const id = "h_" + Date.now() + "_" + Math.random().toString(16).slice(2);
      state.habits.push({
        id,
        title: trimmed,
        createdAt: state.dateKey,
        completedDates: [],
        frequency: frequency || "daily",
        tag: (tag || "").trim(),
        notes: (notes || "").trim(),
        bestStreak: 0
      });
      saveState();
      renderAll();
    }

    function toggleHabitDone(id) {
      const habit = state.habits.find((h) => h.id === id);
      if (!habit) return;
      const idx = habit.completedDates.indexOf(state.dateKey);
      if (idx >= 0) {
        habit.completedDates.splice(idx, 1);
      } else {
        habit.completedDates.push(state.dateKey);
        habit.bestStreak = Math.max(habit.bestStreak || 0, habit.completedDates.length);
      }
      saveState();
      renderAll();
    }

    function deleteHabit(id) {
      state.habits = state.habits.filter((h) => h.id !== id);
      saveState();
      renderAll();
    }

    function updateHabit(id, patch) {
      const habit = state.habits.find((h) => h.id === id);
      if (!habit) return;
      Object.assign(habit, patch);
      saveState();
      renderAll();
    }

    function addTask(title, tag, notes) {
      const trimmed = (title || "").trim();
      if (!trimmed) return;
      const id = "t_" + Date.now() + "_" + Math.random().toString(16).slice(2);
      state.tasks.push({
        id,
        title: trimmed,
        createdAt: state.dateKey,
        done: false,
        tag: (tag || "").trim(),
        notes: (notes || "").trim()
      });
      saveState();
      renderAll();
    }

    function toggleTaskDone(id) {
      const t = state.tasks.find((x) => x.id === id);
      if (!t) return;
      t.done = !t.done;
      saveState();
      renderAll();
    }

    function deleteTask(id) {
      state.tasks = state.tasks.filter((t) => t.id !== id);
      saveState();
      renderAll();
    }

    function updateTask(id, patch) {
      const task = state.tasks.find((t) => t.id === id);
      if (!task) return;
      Object.assign(task, patch);
      saveState();
      renderAll();
    }

    function passesFilter(item, isDoneToday) {
      const text = state.filterText.toLowerCase();
      if (text) {
        const hay = (item.title || "").toLowerCase().includes(text) ||
          (item.tag || "").toLowerCase().includes(text) ||
          (item.notes || "").toLowerCase().includes(text);
        if (!hay) return false;
      }
      if (state.filterStatus === "pending") {
        return !isDoneToday;
      }
      if (state.filterStatus === "done") {
        return isDoneToday;
      }
      return true;
    }

    function renderHabits() {
      const list = document.getElementById("habitsList");
      const metaLabel = document.getElementById("habitsMetaLabel");
      const activeCountEl = document.getElementById("habitsActiveCount");
      const progressPctEl = document.getElementById("habitsProgressPct");
      const bar = document.getElementById("habitsProgressBar");
      const medalsEl = document.getElementById("habitsMedals");

      list.innerHTML = "";
      medalsEl.innerHTML = "";

      if (!state.habits.length) {
        const empty = document.createElement("div");
        empty.className = "empty-state";
        empty.textContent = "A√∫n no hay h√°bitos. Crea uno abajo.";
        list.appendChild(empty);
        metaLabel.textContent = "0/0 completados";
        activeCountEl.textContent = "0";
        progressPctEl.textContent = "0%";
        bar.style.transform = "scaleX(0)";
        return;
      }

      let doneToday = 0;
      let totalShown = 0;

      state.habits.forEach((habit) => {
        const isDone = habit.completedDates.includes(state.dateKey);
        if (!passesFilter(habit, isDone)) {
          return;
        }
        totalShown++;
        if (isDone) doneToday++;

        const item = document.createElement("div");
        item.className = "item";

        const main = document.createElement("div");
        main.className = "item-main";

        const circle = document.createElement("button");
        circle.type = "button";
        circle.className = "check-circle" + (isDone ? " checked" : "");
        circle.textContent = isDone ? "‚úì" : "";
        circle.setAttribute("aria-label", "Marcar h√°bito");
        circle.addEventListener("click", () => toggleHabitDone(habit.id));

        const text = document.createElement("div");
        text.className = "item-text";

        const titleRow = document.createElement("div");
        titleRow.className = "item-title-row";

        const titleEl = document.createElement("span");
        titleEl.className = "item-title";
        titleEl.textContent = habit.title;
        titleEl.title = "Doble clic para editar";

        titleEl.addEventListener("dblclick", () => {
          const input = document.createElement("input");
          input.type = "text";
          input.className = "item-title-input";
          input.value = habit.title;
          titleRow.replaceChild(input, titleEl);
          input.focus();
          input.select();
          const save = () => {
            const v = input.value.trim();
            if (v) {
              updateHabit(habit.id, { title: v });
            } else {
              renderAll();
            }
          };
          input.addEventListener("blur", save);
          input.addEventListener("keydown", (e) => {
            if (e.key === "Enter") save();
            if (e.key === "Escape") renderAll();
          });
        });

        titleRow.appendChild(titleEl);

        if (habit.tag) {
          const tag = document.createElement("span");
          tag.className = "tag-pill";
          tag.textContent = "#" + habit.tag;
          titleRow.appendChild(tag);
        }

        const meta = document.createElement("div");
        meta.className = "item-meta";
        const totalDays = habit.completedDates.length;
        const freqMap = {
          daily: "Diario",
          weekly: "Semanal",
          monthly: "Mensual",
          custom: "Personal"
        };
        meta.textContent =
          (isDone ? "Hecho hoy" : "Sin hacer hoy") +
          " ¬∑ " +
          totalDays +
          " d√≠as en total" +
          " ¬∑ Frecuencia: " +
          (freqMap[habit.frequency] || "Diario");

        text.appendChild(titleRow);
        text.appendChild(meta);

        if (habit.notes) {
          const notesDiv = document.createElement("div");
          notesDiv.className = "item-notes";
          notesDiv.textContent = habit.notes;
          text.appendChild(notesDiv);
        }

        main.appendChild(circle);
        main.appendChild(text);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const chip = document.createElement("span");
        chip.className = "chip";
        chip.textContent = "Racha: " + (habit.bestStreak || 0) + " d√≠as";

        const editBtn = document.createElement("button");
        editBtn.type = "button";
        editBtn.className = "btn-icon edit";
        editBtn.textContent = "‚úé";
        editBtn.title = "Editar notas";
        editBtn.addEventListener("click", () => {
          const newNotes = prompt(
            "Notas para el h√°bito:",
            habit.notes || ""
          );
          if (newNotes !== null) {
            updateHabit(habit.id, { notes: newNotes });
          }
        });

        const del = document.createElement("button");
        del.type = "button";
        del.className = "btn-icon danger";
        del.textContent = "‚úï";
        del.title = "Eliminar h√°bito";
        del.addEventListener("click", () => deleteHabit(habit.id));

        actions.appendChild(chip);
        actions.appendChild(editBtn);
        actions.appendChild(del);

        item.appendChild(main);
        item.appendChild(actions);

        list.appendChild(item);
      });

      const total = totalShown;
      metaLabel.textContent = total ? doneToday + "/" + total + " completados" : "0/0 completados";
      activeCountEl.textContent = String(state.habits.length);

      const pct = total ? Math.round((doneToday / total) * 100) : 0;
      progressPctEl.textContent = pct + "%";
      bar.style.transform = "scaleX(" + pct / 100 + ")";

      const globalBest = state.habits.reduce(
        (max, h) => Math.max(max, h.bestStreak || 0),
        0
      );
      if (globalBest >= 7) {
        const medal = document.createElement("div");
        medal.className = "medal";
        medal.innerHTML = '<span class="icon">üèÖ</span><span>7+ d√≠as seguidos</span>';
        medalsEl.appendChild(medal);
      }
      if (globalBest >= 21) {
        const medal = document.createElement("div");
        medal.className = "medal";
        medal.innerHTML = '<span class="icon">üèÜ</span><span>21+ d√≠as seguidos</span>';
        medalsEl.appendChild(medal);
      }
    }

    function renderTasks() {
      const pendingList = document.getElementById("tasksPendingList");
      const completedList = document.getElementById("tasksCompletedList");
      const metaLabel = document.getElementById("tasksMetaLabel");
      const todayCountEl = document.getElementById("tasksTodayCount");
      const doneCountEl = document.getElementById("tasksDoneCount");
      const pendingLabel = document.getElementById("tasksPendingLabel");
      const completedLabel = document.getElementById("tasksCompletedLabel");
      const medalsEl = document.getElementById("tasksMedals");

      pendingList.innerHTML = "";
      completedList.innerHTML = "";
      medalsEl.innerHTML = "";

      const todayTasks = state.tasks.filter((t) => t.createdAt === state.dateKey);

      const filteredToday = todayTasks.filter((t) =>
        passesFilter(t, t.done)
      );
      const pending = filteredToday.filter((t) => !t.done);
      const completed = filteredToday.filter((t) => t.done);

      const renderTaskItem = (task, isDone) => {
        const item = document.createElement("div");
        item.className = "item";

        const main = document.createElement("div");
        main.className = "item-main";

        const circle = document.createElement("button");
        circle.type = "button";
        circle.className = "check-circle" + (isDone ? " checked" : "");
        circle.textContent = isDone ? "‚úì" : "";
        circle.setAttribute("aria-label", "Marcar tarea");
        circle.addEventListener("click", () => toggleTaskDone(task.id));

        const text = document.createElement("div");
        text.className = "item-text";

        const titleRow = document.createElement("div");
        titleRow.className = "item-title-row";

        const titleEl = document.createElement("span");
        titleEl.className = "item-title";
        titleEl.textContent = task.title;
        titleEl.title = "Doble clic para editar";
        titleEl.addEventListener("dblclick", () => {
          const input = document.createElement("input");
          input.type = "text";
          input.className = "item-title-input";
          input.value = task.title;
          titleRow.replaceChild(input, titleEl);
          input.focus();
          input.select();
          const save = () => {
            const v = input.value.trim();
            if (v) {
              updateTask(task.id, { title: v });
            } else {
              renderAll();
            }
          };
          input.addEventListener("blur", save);
          input.addEventListener("keydown", (e) => {
            if (e.key === "Enter") save();
            if (e.key === "Escape") renderAll();
          });
        });

        titleRow.appendChild(titleEl);

        if (task.tag) {
          const tag = document.createElement("span");
          tag.className = "tag-pill";
          tag.textContent = "#" + task.tag;
          titleRow.appendChild(tag);
        }

        const meta = document.createElement("div");
        meta.className = "item-meta";
        meta.textContent = isDone ? "Marcada como hecha" : "Pendiente";

        text.appendChild(titleRow);
        text.appendChild(meta);

        if (task.notes) {
          const notesDiv = document.createElement("div");
          notesDiv.className = "item-notes";
          notesDiv.textContent = task.notes;
          text.appendChild(notesDiv);
        }

        main.appendChild(circle);
        main.appendChild(text);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const chip = document.createElement("span");
        chip.className = "chip";
        chip.textContent = "Hoy";

        const editBtn = document.createElement("button");
        editBtn.type = "button";
        editBtn.className = "btn-icon edit";
        editBtn.textContent = "‚úé";
        editBtn.title = "Editar notas";
        editBtn.addEventListener("click", () => {
          const newNotes = prompt(
            "Notas para la tarea:",
            task.notes || ""
          );
          if (newNotes !== null) {
            updateTask(task.id, { notes: newNotes });
          }
        });

        const del = document.createElement("button");
        del.type = "button";
        del.className = "btn-icon danger";
        del.textContent = "‚úï";
        del.title = "Eliminar tarea";
        del.addEventListener("click", () => deleteTask(task.id));

        actions.appendChild(chip);
        actions.appendChild(editBtn);
        actions.appendChild(del);

        item.appendChild(main);
        item.appendChild(actions);

        return item;
      };

      if (!todayTasks.length) {
        const empty = document.createElement("div");
        empty.className = "empty-state";
        empty.textContent = "A√∫n no hay tareas para hoy. A√±ade una abajo.";
        pendingList.appendChild(empty);
      } else {
        if (!pending.length) {
          const empty = document.createElement("div");
          empty.className = "empty-state";
          empty.textContent = "Nada pendiente. Bien.";
          pendingList.appendChild(empty);
        } else {
          pending.forEach((t) => pendingList.appendChild(renderTaskItem(t, false)));
        }

        if (!completed.length) {
          const empty = document.createElement("div");
          empty.className = "empty-state";
          empty.textContent = "Sin tareas completadas a√∫n.";
          completedList.appendChild(empty);
        } else {
          completed.forEach((t) =>
            completedList.appendChild(renderTaskItem(t, true))
          );
        }
      }

      const totalToday = todayTasks.length;
      const done = todayTasks.filter((t) => t.done).length;
      const pendTotal = todayTasks.filter((t) => !t.done).length;

      metaLabel.textContent =
        pendTotal + " pendientes ¬∑ " + done + " hechas";
      todayCountEl.textContent = String(totalToday);
      doneCountEl.textContent = String(done);
      pendingLabel.textContent = String(pendTotal);
      completedLabel.textContent = String(done);

      if (done >= 5) {
        const medal = document.createElement("div");
        medal.className = "medal";
        medal.innerHTML = '<span class="icon">‚≠ê</span><span>5 tareas hoy</span>';
        medalsEl.appendChild(medal);
      }
      if (done >= 10) {
        const medal = document.createElement("div");
        medal.className = "medal";
        medal.innerHTML = '<span class="icon">üî•</span><span>10+ tareas hoy</span>';
        medalsEl.appendChild(medal);
      }
    }

    function renderHabitsMiniChart() {
      const container = document.getElementById("habitsMiniChart");
      container.innerHTML = "";

      const today = new Date(state.dateKey);
      const days = [];
      for (let i = 6; i >= 0; i--) {
        const d = new Date(today);
        d.setDate(today.getDate() - i);
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        days.push(y + "-" + m + "-" + day);
      }

      const counts = days.map((dayKey) => {
        let c = 0;
        state.habits.forEach((h) => {
          if (h.completedDates && h.completedDates.includes(dayKey)) {
            c++;
          }
        });
        return c;
      });

      const max = Math.max(1, ...counts);
      counts.forEach((c) => {
        const bar = document.createElement("div");
        bar.className = "mini-bar";
        bar.style.height = (c / max) * 100 + "%";
        container.appendChild(bar);
      });
    }

    function renderTabsCounts() {
      const tabTotal = document.getElementById("tabTotalCount");
      const tabHabits = document.getElementById("tabHabitsCount");
      const tabTasks = document.getElementById("tabTasksCount");

      const totalHabits = state.habits.length;
      const habitsDone = state.habits.filter((h) =>
        h.completedDates.includes(state.dateKey)
      ).length;

      const todayTasks = state.tasks.filter((t) => t.createdAt === state.dateKey);
      const tasksDone = todayTasks.filter((t) => t.done).length;

      const totalItems = totalHabits + todayTasks.length;
      const totalDone = habitsDone + tasksDone;

      tabTotal.textContent = totalItems
        ? totalDone + "/" + totalItems
        : "0/0";
      tabHabits.textContent = String(totalHabits);
      tabTasks.textContent = String(todayTasks.length);
    }

    function applyTabs() {
      const tabs = document.querySelectorAll(".tab");
      const habitsCard = document.getElementById("habitsCard");
      const tasksCard = document.getElementById("tasksCard");

      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          tabs.forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");
          const view = tab.getAttribute("data-view");

          if (view === "both") {
            habitsCard.style.display = "";
            tasksCard.style.display = "";
          } else if (view === "habits") {
            habitsCard.style.display = "";
            tasksCard.style.display = "none";
          } else if (view === "tasks") {
            habitsCard.style.display = "none";
            tasksCard.style.display = "";
          }
        });
      });
    }

    function attachInputs() {
      const habitInput = document.getElementById("habitInput");
      const habitTagInput = document.getElementById("habitTagInput");
      const habitNotesInput = document.getElementById("habitNotesInput");
      const habitFrequency = document.getElementById("habitFrequency");
      const addHabitBtn = document.getElementById("addHabitBtn");

      const taskInput = document.getElementById("taskInput");
      const taskTagInput = document.getElementById("taskTagInput");
      const taskNotesInput = document.getElementById("taskNotesInput");
      const addTaskBtn = document.getElementById("addTaskBtn");

      const searchInput = document.getElementById("searchInput");
      const filterChips = document.querySelectorAll(".filter-chip");

      const themeToggle = document.getElementById("themeToggle");
      themeToggle.addEventListener("click", toggleTheme);

      addHabitBtn.addEventListener("click", () => {
        addHabit(
          habitInput.value,
          habitTagInput.value,
          habitFrequency.value,
          habitNotesInput.value
        );
        habitInput.value = "";
        habitTagInput.value = "";
        habitNotesInput.value = "";
        habitInput.focus();
      });

      habitInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          addHabit(
            habitInput.value,
            habitTagInput.value,
            habitFrequency.value,
            habitNotesInput.value
          );
          habitInput.value = "";
          habitTagInput.value = "";
          habitNotesInput.value = "";
        }
      });

      addTaskBtn.addEventListener("click", () => {
        addTask(
          taskInput.value,
          taskTagInput.value,
          taskNotesInput.value
        );
        taskInput.value = "";
        taskTagInput.value = "";
        taskNotesInput.value = "";
        taskInput.focus();
      });

      taskInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          addTask(
            taskInput.value,
            taskTagInput.value,
            taskNotesInput.value
          );
          taskInput.value = "";
          taskTagInput.value = "";
          taskNotesInput.value = "";
        }
      });

      searchInput.addEventListener("input", () => {
        state.filterText = searchInput.value || "";
        renderAll();
      });

      filterChips.forEach((chip) => {
        chip.addEventListener("click", () => {
          filterChips.forEach((c) => c.classList.remove("active"));
          chip.classList.add("active");
          state.filterStatus = chip.getAttribute("data-filter") || "all";
          renderAll();
        });
      });

      const exportBtn = document.getElementById("exportBtn");
      const importInput = document.getElementById("importInput");

      exportBtn.addEventListener("click", () => {
        const dataStr = JSON.stringify({
          habits: state.habits,
          tasks: state.tasks,
          streak: state.streak,
          lastDate: state.dateKey
        }, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "habit_task_tracker_backup.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });

      importInput.addEventListener("change", (e) => {
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (evt) => {
          try {
            const imported = JSON.parse(evt.target.result);
            if (imported && typeof imported === "object") {
              state.habits = imported.habits || [];
              state.tasks = imported.tasks || [];
              state.streak = imported.streak || 0;
              state.lastDate = imported.lastDate || null;
              saveState();
              renderAll();
              alert("Datos importados correctamente.");
            } else {
              alert("Archivo inv√°lido.");
            }
          } catch (err) {
            console.error(err);
            alert("Error al importar el archivo.");
          }
        };
        reader.readAsText(file);
        importInput.value = "";
      });
    }

    function renderAll() {
      renderHeader();
      renderHabits();
      renderTasks();
      renderHabitsMiniChart();
      renderTabsCounts();
    }

    function init() {
      loadState();
      state.dateKey = todayKey();
      updateStreak();
      applyTheme();
      renderAll();
      applyTabs();
      attachInputs();
      saveState();
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>